## Secure Water Treatment testbed (SWaT)

SWaT is a fully operational scaled-down water treatment plant that produces doubly-filtered drinking water. SWaT consists of five water-processing tanks, as well as the pipes that connect those tanks. The in-coming valve and out-going valve of each tank can be controlled remotely via network. The objective of a self-adaptive SWaT system is to enable safe (e.g., no overflow or underflow in any of the tanks) and efficient (e.g., maximum clean water production) water filtering under different environmental situations (e.g., the initial water level of the five tanks, and the in-coming water flow of the first tank). 

### Negative, positive and attack test configurations
* The negative test configurations use the original settings and environment input of [SWaT](https://github.com/tongyanxiang/MoD2/tree/main/subject/SWaT).
* The positive test configurations are generated by introducing manipulation disturbance to the valves, simulated by modifying valves' running time `tau` with a random ratio in *swat/plant/plant.py* at a random model deviation time point. 
* The attack test configurations are generated by introducing injecting network attacks (**listed in SWaT/trace/swat_network_attacks.xlsx**) at a random model deviation time point. 

### Collected traces
For each test configuration, the execution trace records measured water levels of five tanks and control signals to valves of six PLCs as follows:
  ```
  812.38289008135,792.1686188980214,815.7506728733921,698.5948360985067,666.3035198207283
  0,0,0,0,0,0,0,0,0,0
  1,1,1,1,1,1,1,1,1,1
  0,0,0,0,0,0,0,0,0,0
  812.4341702885405,792.219353301958,815.7675154259271,698.5567618185817,666.2125898964978
  0,1,0,0,0,1,0,0,1,1
  1,0,1,1,1,0,1,1,0,0
  0,0,0,0,0,0,0,0,0,0
  ...
  ```
* We have collected 200 negaitive traces, 200 positive traces and 200 attack traces at the length of (1.0/0.05)*60*30 adaptation loops (0.05s for each loop)
* The time interval of model deviation detection is 1.0s and the ouput of optimal controller is signals with 0 or 1. therefore, the traces will be preprocessed as `u_1` and `y` and then input to MoD2.

### Reproduction of experimental results
We provide three scripts to reproduce experimental reuslts of the effectiveness and usefulness.

#### Effectiveness with the input of negative and positive traces
  * Unzip SWaTTraces.zip and move subfolders *evalNegativeTrace_tau_0.05* and *evalPositiveTrace_tau_0.05* to *SWaT/trace*
  * Go to *SWaT/detector* and run *evaluateEffectiveness4SWaT.py* in a terminal. The output looks like this:

  ```
  ~~~~~ Evaluating effectiveness of MoD2 ~~~~~

  load negative test configurations and apply MoD2...

  load positive test configurations and apply MoD2...

  *** statistical result ***
  False Positive Rate: 0.0%
  False Negative Rate: 0.0%
  Mean Time Delay: 39.23s
  ```

#### Effectiveness with the input attack traces
* Unzip SWaTTraces.zip and move subfolder *evalAttackTrace_tau_0.05* to *SWaT/trace*
* Go to *SWaT/detector* and run *evaluateEffectiveness4SWaTAttack.py* in a terminal. The output looks like this:

  ```
  ~~~~~ Evaluating effectiveness of MoD2 ~~~~~

  load attack test configurations and apply MoD2...

  *** statistical result ***
  False Positive Rate: 0.0%
  False Negative Rate: 0.0%
  Mean Time Delay: 10.2s
  ```

#### Usefulness with the input attack traces
* Unzip SWaTTraces.zip and move subfolder *evalAttackTrace_tau_0.05* to *RUBiS/trace*
* Go to *SWaT/detector* and run *evaluateUsefulness4SWaT.py* in a terminal. The output looks like this:

  ```
  ~~~~~~ Evaluating usefulness of MoD2 ~~~~~

  processing...

  *** original control-SAS ***
  deviation time: 1081.31s
  abnormal time: 162.45s
  abnormal rate: 14.0%


  processing...

  *** MoD2-based adaptation-supervision mechanism ***
  deviation time: 1081.31s
  abnormal time: 0.0s
  abnormal rate: 0.0%
  ```
